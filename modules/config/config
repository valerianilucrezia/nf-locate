nextflow.enable.dsl=2
cleanup=false

includeConfig "$baseDir/modules/config/params.config"

singularity {
  enabled = true
  singularity.envWhitelist = ["SINGULARITY_TMPDIR"]
  runOptions = '--bind /orfeo:/orfeo --bind $SINGULARITY_TMPDIR:/tmp'
}

process {
   executor='slurm'
   queue='THIN'
   errorStrategy = 'finish'
}

process {

  // methylation_calling
  withName: 'MODKIT' {
    time='12h'
    container = 'https://depot.galaxyproject.org/singularity/ont-modkit%3A0.3.1--h5c23e0d_1'
    memory = '20 GB'
    errorStrategy = 'finish'
  }

  withName: 'PILEUP_METH' {
    time='12h'
    container = 'https://depot.galaxyproject.org/singularity/bcftools%3A1.9--ha228f0b_4'
    memory = '20 GB'
    errorStrategy = 'finish'
  }

  withName: 'GET_POSITIONS' {
    time='12h'
    container = 'docker://lvaleriani/long_reads:latest'
    memory = '20 GB'
    errorStrategy = 'finish'
  }

  withName: 'READ_BED' {
    time='12h'
    container = 'docker://lvaleriani/long_reads:latest'
    memory = '20 GB'
    errorStrategy = 'finish'
  }

  withName: 'COMBINE' {
    time='12h'
    container = 'docker://lvaleriani/long_reads:latest'
    memory = '20 GB'
    errorStrategy = 'finish'
  }

  // pileup
  withName: 'SPLIT_BAM' {
    time='12h'
    container = 'https://depot.galaxyproject.org/singularity/samtools%3A1.9--h91753b0_8'
    memory = '20 GB'
    errorStrategy = 'finish'
  }

  withName: 'PILEUP_CN' {
    time='12h'
    container = 'https://depot.galaxyproject.org/singularity/bcftools%3A1.9--ha228f0b_4'
    memory = '20 GB'
    errorStrategy = 'finish'
  }

  withName: 'WHATSHAP' {
    time='12h'
    container = 'https://depot.galaxyproject.org/singularity/whatshap%3A2.3--py39h1f90b4d_0'
    memory = '20 GB'
    errorStrategy = 'finish'
  }

  withName: 'READ_PHASING' {
    time='12h'
    container = 'docker://lvaleriani/long_reads:latest'
    memory = '20 GB'
    errorStrategy = 'finish'
  }

  // variant_calling
  withName: 'CLAIRS' {
    time='12h'
    container = 'docker://hkubal/clairs:latest'
    memory = '20 GB'
    errorStrategy = 'finish'
  }

  withName: 'READ_SOMATIC' {
    time='12h'
    container = 'docker://lvaleriani/long_reads:latest'
    memory = '20 GB'
    errorStrategy = 'finish'
  }

}